<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		*{margin:0;padding:0;}
	</style>
</head>
<body>
	
</body>
</html>
<script type="text/javascript" src="js/jquery-1.11.1.js"></script>
<script type="text/javascript" src="js/pixi.min.js"></script>
<script type="text/javascript" src="js/pixi-display.js"></script>
<script type="text/javascript" src="js/matter.js"></script>
<script type="text/javascript" src="js/ball.js"></script>
<script type="text/javascript" src="js/bank.js"></script>
<script>
	var bunny,renderer,stage;
	// var G = 0.98;//重力加速度;

	// matter模块
	var Engine = Matter.Engine,
	    Render = Matter.RenderPixi,
	    World = Matter.World,
	    Constraint = Matter.Constraint,
	    Runner = Matter.Runner,
	    Bodies = Matter.Bodies;


	// create an engine
	var engine = Engine.create();
	engine.world.gravity.scale = 0.002;
	engine.enableSleeping = true;
	// create an runner
	var runner = Runner.create();
	// create a renderer

	var layer = new PIXI.DisplayGroup(0, false);
	var layer1 = new PIXI.DisplayGroup(2, false);

	var wwidth = $(window).width();
	var wheight = $(window).height();


	init();
	animate();
	function init(){
		// 创建pixi的stage
		stage = new PIXI.Container();
		stage.displayList = new PIXI.DisplayList();

		var backgroundSprite = PIXI.Sprite.fromImage("images/bg_ys.png");
		backgroundSprite.width = wwidth;
		backgroundSprite.height = wheight;


		// 创建一个渲染
		renderer = PIXI.autoDetectRenderer(wwidth,wheight);
		// 添加到页面
		document.body.appendChild(renderer.view);

		backgroundSprite.interactive = true;
		// backgroundSprite.on('mousedown', onDown);
		// backgroundSprite.on('touchstart', onDown);
		backgroundSprite.on('mouseup',ballStart);
		backgroundSprite.on('touchend',ballStart);

		stage.addChild(backgroundSprite);

		var ground = Bodies.rectangle(wwidth/2, wheight, wwidth, 60, { isStatic: true });
		var ground1 = Bodies.rectangle(wwidth, wheight/2, 60, wheight, { isStatic: true });
		Matter.Body.setDensity(ground,1);
		World.add(engine.world, [ground]);

		Runner.start(runner,engine);

		var bank = new PIXI_BANK(800,800,engine,stage);
		setTimeout(function(){
			// bank.destroy();
		},10000);
		// bank = new PIXI_BANK(600,700,engine.world,stage);


		// Matter.Events.on(runner,'beforeUpdate',function(){
		// 	console.log(rim.position.x);
		// });

		// Matter.RenderPixi.world(engine);
		// Matter.RenderPixi.body(engine, ground);
		
		
	}
	function ballStart(eventData){


		// Runner.stop(runner,engine);
		var x = eventData.data.global.x;
		var y = eventData.data.global.y;

		var ball = new PIXI_BALL( 100 ,wheight - 200,engine,stage);
		ball.setBallVelocity(x,wheight - y,wwidth,wheight);
		


		// add all of the bodies to the world
		// Runner.start(runner,engine);

		// Matter.Events.on(runner,'beforeUpdate',function(){
		// 	ball.animate && ball.animate();
		// 	renderer.render(stage);
		// });
	}
	// var render = Render.create({
	//     element: document.body,
	//     engine: engine
	// });

	// Render.run(render);

	function animate() {
		requestAnimationFrame( animate );
		renderer.render(stage);
	}




</script>